<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>techminer2.scientopy.bar_trends &mdash; TechMiner2 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/toggleprompt.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            TechMiner2
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/release_info.html">Release Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/license.html">MIT License</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Software comparison</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../techminer/__index__.html">TechMiner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bibliometrix/__index__.html">Bibliometrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vantagepoint/__index__.html">VantagePoint</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tlab/__index__.html">T-LAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scientopy/__index__.html">ScientoPy</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">TechMiner2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">techminer2.scientopy.bar_trends</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for techminer2.scientopy.bar_trends</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Bar Trends</span>
<span class="sd">===============================================================================</span>

<span class="sd">ScientoPy Bar Trends</span>


<span class="sd">**Basic Usage.**</span>

<span class="sd">&gt;&gt;&gt; from techminer2 import scientopy</span>
<span class="sd">&gt;&gt;&gt; directory = &quot;data/regtech/&quot;</span>

<span class="sd">&gt;&gt;&gt; file_name = &quot;sphinx/_static/scientpy__bar_trends-1.html&quot;</span>
<span class="sd">&gt;&gt;&gt; r = scientopy.bar_trends(</span>
<span class="sd">...     criterion=&quot;author_keywords&quot;,</span>
<span class="sd">...     directory=directory,</span>
<span class="sd">... )</span>
<span class="sd">&gt;&gt;&gt; r.plot_.write_html(file_name)</span>

<span class="sd">.. raw:: html</span>

<span class="sd">    &lt;iframe src=&quot;../_static/scientpy__bar_trends-1.html&quot; height=&quot;800px&quot; width=&quot;100%&quot; frameBorder=&quot;0&quot;&gt;&lt;/iframe&gt;</span>


<span class="sd">&gt;&gt;&gt; r.table_.head()</span>
<span class="sd">                       Before 2022  Between 2022-2023</span>
<span class="sd">author_keywords                                      </span>
<span class="sd">regtech                         20                  8</span>
<span class="sd">fintech                         10                  2</span>
<span class="sd">regulatory technology            5                  2</span>
<span class="sd">compliance                       5                  2</span>
<span class="sd">regulation                       4                  1</span>


<span class="sd">&gt;&gt;&gt; print(r.prompt_)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">Imagine that you are a researcher analyzing a bibliographic dataset. The table below provides data on top most frequent 20 author_keywords in the dataset. The terms &#39;Before 2022&#39; and &#39;Between 2022-2023&#39; in the column &#39;Period&#39; represent the time windows. The column &#39;Num Documents&#39; represents the number of documents in the time window. Use the information in the table to draw conclusions about growth trends of the &#39;author_keywords&#39;. In your analysis, be sure to describe in a clear and concise way, any findings or any patterns you observe, and identify any outliers or anomalies in the data. Limit your description to one paragraph with no more than 250 words.</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">|    | Author Keywords         | Period            |   Num Documents |</span>
<span class="sd">|---:|:------------------------|:------------------|----------------:|</span>
<span class="sd">|  0 | regtech                 | Before 2022       |              20 |</span>
<span class="sd">|  1 | fintech                 | Before 2022       |              10 |</span>
<span class="sd">|  2 | regulatory technology   | Before 2022       |               5 |</span>
<span class="sd">|  3 | compliance              | Before 2022       |               5 |</span>
<span class="sd">|  4 | regulation              | Before 2022       |               4 |</span>
<span class="sd">|  5 | financial services      | Before 2022       |               3 |</span>
<span class="sd">|  6 | financial regulation    | Before 2022       |               2 |</span>
<span class="sd">|  7 | artificial intelligence | Before 2022       |               3 |</span>
<span class="sd">|  8 | anti-money laundering   | Before 2022       |               3 |</span>
<span class="sd">|  9 | risk management         | Before 2022       |               2 |</span>
<span class="sd">| 10 | innovation              | Before 2022       |               2 |</span>
<span class="sd">| 11 | blockchain              | Before 2022       |               3 |</span>
<span class="sd">| 12 | suptech                 | Before 2022       |               1 |</span>
<span class="sd">| 13 | semantic technologies   | Before 2022       |               2 |</span>
<span class="sd">| 14 | data protection         | Before 2022       |               1 |</span>
<span class="sd">| 15 | smart contracts         | Before 2022       |               2 |</span>
<span class="sd">| 16 | charitytech             | Before 2022       |               1 |</span>
<span class="sd">| 17 | english law             | Before 2022       |               1 |</span>
<span class="sd">| 18 | gdpr                    | Before 2022       |               2 |</span>
<span class="sd">| 19 | data protection officer | Before 2022       |               2 |</span>
<span class="sd">| 20 | regtech                 | Between 2022-2023 |               8 |</span>
<span class="sd">| 21 | fintech                 | Between 2022-2023 |               2 |</span>
<span class="sd">| 22 | regulatory technology   | Between 2022-2023 |               2 |</span>
<span class="sd">| 23 | compliance              | Between 2022-2023 |               2 |</span>
<span class="sd">| 24 | regulation              | Between 2022-2023 |               1 |</span>
<span class="sd">| 25 | financial services      | Between 2022-2023 |               1 |</span>
<span class="sd">| 26 | financial regulation    | Between 2022-2023 |               2 |</span>
<span class="sd">| 27 | artificial intelligence | Between 2022-2023 |               1 |</span>
<span class="sd">| 28 | anti-money laundering   | Between 2022-2023 |               0 |</span>
<span class="sd">| 29 | risk management         | Between 2022-2023 |               1 |</span>
<span class="sd">| 30 | innovation              | Between 2022-2023 |               1 |</span>
<span class="sd">| 31 | blockchain              | Between 2022-2023 |               0 |</span>
<span class="sd">| 32 | suptech                 | Between 2022-2023 |               2 |</span>
<span class="sd">| 33 | semantic technologies   | Between 2022-2023 |               0 |</span>
<span class="sd">| 34 | data protection         | Between 2022-2023 |               1 |</span>
<span class="sd">| 35 | smart contracts         | Between 2022-2023 |               0 |</span>
<span class="sd">| 36 | charitytech             | Between 2022-2023 |               1 |</span>
<span class="sd">| 37 | english law             | Between 2022-2023 |               1 |</span>
<span class="sd">| 38 | gdpr                    | Between 2022-2023 |               0 |</span>
<span class="sd">| 39 | data protection officer | Between 2022-2023 |               0 |</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">&lt;BLANKLINE&gt;</span>



<span class="sd">**Time Filter.**</span>

<span class="sd">&gt;&gt;&gt; file_name = &quot;sphinx/_static/scientpy__bar_trends-3.html&quot;</span>
<span class="sd">&gt;&gt;&gt; r = scientopy.bar_trends(</span>
<span class="sd">...     criterion=&quot;author_keywords&quot;,</span>
<span class="sd">...     start_year=2018,</span>
<span class="sd">...     end_year=2021,</span>
<span class="sd">...     directory=directory,</span>
<span class="sd">... )</span>
<span class="sd">&gt;&gt;&gt; r.plot_.write_html(file_name)</span>

<span class="sd">.. raw:: html</span>

<span class="sd">    &lt;iframe src=&quot;../_static/scientpy__bar_trends-3.html&quot; height=&quot;800px&quot; width=&quot;100%&quot; frameBorder=&quot;0&quot;&gt;&lt;/iframe&gt;</span>

<span class="sd">&gt;&gt;&gt; r.table_.head()</span>
<span class="sd">                       Before 2020  Between 2020-2021</span>
<span class="sd">author_keywords                                      </span>
<span class="sd">regtech                          7                 11</span>
<span class="sd">fintech                          6                  4</span>
<span class="sd">regulatory technology            0                  5</span>
<span class="sd">compliance                       1                  4</span>
<span class="sd">regulation                       2                  2</span>


<span class="sd">**Custom Topics Extraction.**</span>

<span class="sd">&gt;&gt;&gt; file_name = &quot;sphinx/_static/scientpy__bar_trends-4.html&quot;</span>
<span class="sd">&gt;&gt;&gt; from techminer2 import scientopy</span>
<span class="sd">&gt;&gt;&gt; r = scientopy.bar_trends(</span>
<span class="sd">...     criterion=&quot;author_keywords&quot;,</span>
<span class="sd">...     custom_topics=[</span>
<span class="sd">...         &quot;fintech&quot;, </span>
<span class="sd">...         &quot;blockchain&quot;, </span>
<span class="sd">...         &quot;financial regulation&quot;, </span>
<span class="sd">...         &quot;machine learning&quot;,</span>
<span class="sd">...         &quot;big data&quot;,</span>
<span class="sd">...         &quot;cryptocurrency&quot;,</span>
<span class="sd">...     ],</span>
<span class="sd">...     directory=directory,</span>
<span class="sd">... )</span>
<span class="sd">&gt;&gt;&gt; r.plot_.write_html(file_name)</span>

<span class="sd">.. raw:: html</span>

<span class="sd">    &lt;iframe src=&quot;../_static/scientpy__bar_trends-4.html&quot; height=&quot;800px&quot; width=&quot;100%&quot; frameBorder=&quot;0&quot;&gt;&lt;/iframe&gt;</span>




<span class="sd">&gt;&gt;&gt; file_name = &quot;sphinx/_static/scientpy__bar_trends-5.html&quot;</span>
<span class="sd">&gt;&gt;&gt; r = scientopy.bar_trends(</span>
<span class="sd">...     criterion=&quot;author_keywords&quot;,</span>
<span class="sd">...     trend_analysis=True,</span>
<span class="sd">...     start_year=2018,</span>
<span class="sd">...     end_year=2021,</span>
<span class="sd">...     directory=directory,</span>
<span class="sd">... )</span>
<span class="sd">&gt;&gt;&gt; r.plot_.write_html(file_name)</span>

<span class="sd">.. raw:: html</span>

<span class="sd">    &lt;iframe src=&quot;../_static/scientpy__bar_trends-5.html&quot; height=&quot;800px&quot; width=&quot;100%&quot; frameBorder=&quot;0&quot;&gt;&lt;/iframe&gt;</span>


<span class="sd">&gt;&gt;&gt; r.table_.head()    </span>
<span class="sd">                       Before 2020  Between 2020-2021</span>
<span class="sd">author_keywords                                      </span>
<span class="sd">regulatory technology            0                  5</span>
<span class="sd">regulation                       2                  2</span>
<span class="sd">anti-money laundering            0                  3</span>
<span class="sd">accountability                   0                  2</span>
<span class="sd">gdpr                             0                  2</span>

<span class="sd">&gt;&gt;&gt; print(r.prompt_)</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">Imagine that you are a researcher analyzing a bibliographic dataset. The table below provides data on top 20 &#39;author_keywords&#39; with the highest average growth rate in the dataset. The terms &#39;Before 2020&#39; and &#39;Between 2020-2021&#39; in the column &#39;Period&#39; represent the time windows. The column &#39;Num Documents&#39; represents the number of documents in the time window. Use the information in the table to draw conclusions about growth trends of the &#39;author_keywords&#39;. In your analysis, be sure to describe in a clear and concise way, any findings or any patterns you observe, and identify any outliers or anomalies in the data. Limit your description to one paragraph with no more than 250 words.</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">|    | Author Keywords                 | Period            |   Num Documents |</span>
<span class="sd">|---:|:--------------------------------|:------------------|----------------:|</span>
<span class="sd">|  0 | regulatory technology           | Before 2020       |               0 |</span>
<span class="sd">|  1 | regulation                      | Before 2020       |               2 |</span>
<span class="sd">|  2 | anti-money laundering           | Before 2020       |               0 |</span>
<span class="sd">|  3 | accountability                  | Before 2020       |               0 |</span>
<span class="sd">|  4 | gdpr                            | Before 2020       |               0 |</span>
<span class="sd">|  5 | data protection officer         | Before 2020       |               0 |</span>
<span class="sd">|  6 | anti money laundering (aml)     | Before 2020       |               0 |</span>
<span class="sd">|  7 | innovation                      | Before 2020       |               0 |</span>
<span class="sd">|  8 | smart treasury                  | Before 2020       |               0 |</span>
<span class="sd">|  9 | regulations and compliance      | Before 2020       |               0 |</span>
<span class="sd">| 10 | coronavirus                     | Before 2020       |               0 |</span>
<span class="sd">| 11 | digital technologies            | Before 2020       |               0 |</span>
<span class="sd">| 12 | bahrain                         | Before 2020       |               0 |</span>
<span class="sd">| 13 | resale price maintenance        | Before 2020       |               0 |</span>
<span class="sd">| 14 | competition law                 | Before 2020       |               0 |</span>
<span class="sd">| 15 | antitrust                       | Before 2020       |               0 |</span>
<span class="sd">| 16 | vertical price fixing           | Before 2020       |               0 |</span>
<span class="sd">| 17 | financial fraud detection       | Before 2020       |               0 |</span>
<span class="sd">| 18 | classification (of information) | Before 2020       |               0 |</span>
<span class="sd">| 19 | anomaly detection               | Before 2020       |               0 |</span>
<span class="sd">| 20 | regulatory technology           | Between 2020-2021 |               5 |</span>
<span class="sd">| 21 | regulation                      | Between 2020-2021 |               2 |</span>
<span class="sd">| 22 | anti-money laundering           | Between 2020-2021 |               3 |</span>
<span class="sd">| 23 | accountability                  | Between 2020-2021 |               2 |</span>
<span class="sd">| 24 | gdpr                            | Between 2020-2021 |               2 |</span>
<span class="sd">| 25 | data protection officer         | Between 2020-2021 |               2 |</span>
<span class="sd">| 26 | anti money laundering (aml)     | Between 2020-2021 |               2 |</span>
<span class="sd">| 27 | innovation                      | Between 2020-2021 |               2 |</span>
<span class="sd">| 28 | smart treasury                  | Between 2020-2021 |               1 |</span>
<span class="sd">| 29 | regulations and compliance      | Between 2020-2021 |               1 |</span>
<span class="sd">| 30 | coronavirus                     | Between 2020-2021 |               1 |</span>
<span class="sd">| 31 | digital technologies            | Between 2020-2021 |               1 |</span>
<span class="sd">| 32 | bahrain                         | Between 2020-2021 |               1 |</span>
<span class="sd">| 33 | resale price maintenance        | Between 2020-2021 |               1 |</span>
<span class="sd">| 34 | competition law                 | Between 2020-2021 |               1 |</span>
<span class="sd">| 35 | antitrust                       | Between 2020-2021 |               1 |</span>
<span class="sd">| 36 | vertical price fixing           | Between 2020-2021 |               1 |</span>
<span class="sd">| 37 | financial fraud detection       | Between 2020-2021 |               1 |</span>
<span class="sd">| 38 | classification (of information) | Between 2020-2021 |               1 |</span>
<span class="sd">| 39 | anomaly detection               | Between 2020-2021 |               1 |</span>
<span class="sd">&lt;BLANKLINE&gt;</span>
<span class="sd">&lt;BLANKLINE&gt;</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="kn">from</span> <span class="nn">..techminer.indicators.growth_indicators_by_topic</span> <span class="kn">import</span> <span class="n">growth_indicators_by_topic</span>
<span class="kn">from</span> <span class="nn">.bar</span> <span class="kn">import</span> <span class="n">_filter_indicators_by_custom_topics</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">_Results</span><span class="p">:</span>
    <span class="n">plot_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">table_</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">prompt_</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="bar_trends"><a class="viewcode-back" href="../../../scientopy/bar_trends.html#techminer2.scientopy.bar_trends.bar_trends">[docs]</a><span class="k">def</span> <span class="nf">bar_trends</span><span class="p">(</span>
    <span class="n">criterion</span><span class="p">,</span>
    <span class="n">time_window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">topics_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">custom_topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">trend_analysis</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Trend&quot;</span><span class="p">,</span>
    <span class="n">directory</span><span class="o">=</span><span class="s2">&quot;./&quot;</span><span class="p">,</span>
    <span class="n">database</span><span class="o">=</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span>
    <span class="n">start_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">filters</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ScientoPy Bar Trend.&quot;&quot;&quot;</span>

    <span class="n">indicators</span> <span class="o">=</span> <span class="n">growth_indicators_by_topic</span><span class="p">(</span>
        <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span>
        <span class="n">time_window</span><span class="o">=</span><span class="n">time_window</span><span class="p">,</span>
        <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">,</span>
        <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">,</span>
        <span class="n">start_year</span><span class="o">=</span><span class="n">start_year</span><span class="p">,</span>
        <span class="n">end_year</span><span class="o">=</span><span class="n">end_year</span><span class="p">,</span>
        <span class="o">**</span><span class="n">filters</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">trend_analysis</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;average_growth_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;OCC&quot;</span><span class="p">,</span> <span class="s2">&quot;global_citations&quot;</span><span class="p">],</span>
            <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
            <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OCC&quot;</span><span class="p">,</span> <span class="s2">&quot;global_citations&quot;</span><span class="p">,</span> <span class="s2">&quot;average_growth_rate&quot;</span><span class="p">],</span>
            <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="n">indicators</span> <span class="o">=</span> <span class="n">_filter_indicators_by_custom_topics</span><span class="p">(</span>
        <span class="n">indicators</span><span class="o">=</span><span class="n">indicators</span><span class="p">,</span>
        <span class="n">topics_length</span><span class="o">=</span><span class="n">topics_length</span><span class="p">,</span>
        <span class="n">custom_topics</span><span class="o">=</span><span class="n">custom_topics</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span>
        <span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OCC&quot;</span><span class="p">,</span> <span class="s2">&quot;global_citations&quot;</span><span class="p">,</span> <span class="s2">&quot;average_growth_rate&quot;</span><span class="p">],</span>
        <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">col0</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">col1</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="p">[[</span><span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">]]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">_Results</span><span class="p">()</span>
    <span class="n">results</span><span class="o">.</span><span class="n">table_</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">])</span>
    <span class="n">indicators</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
            <span class="n">criterion</span><span class="p">:</span> <span class="n">criterion</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;Period&quot;</span><span class="p">,</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="s2">&quot;Num Documents&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">plot_</span> <span class="o">=</span> <span class="n">_make_plot</span><span class="p">(</span><span class="n">indicators</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">prompt_</span> <span class="o">=</span> <span class="n">_create_prompt</span><span class="p">(</span><span class="n">indicators</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">trend_analysis</span><span class="p">,</span> <span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span></div>


<span class="k">def</span> <span class="nf">_create_prompt</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">trend_analysis</span><span class="p">,</span> <span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">trend_analysis</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Imagine that you are a researcher analyzing a bibliographic dataset. </span><span class="se">\</span>
<span class="s2">The table below provides data on top </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> &#39;</span><span class="si">{</span><span class="n">criterion</span><span class="si">}</span><span class="s2">&#39; </span><span class="se">\</span>
<span class="s2">with the highest average growth rate in the dataset. </span><span class="se">\</span>
<span class="s2">The terms &#39;</span><span class="si">{</span><span class="n">col0</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; in the column &#39;Period&#39; represent the time windows. </span><span class="se">\</span>
<span class="s2">The column &#39;Num Documents&#39; represents the number of documents in the time window. </span><span class="se">\</span>
<span class="s2">Use the information in the table to draw conclusions about growth trends of the &#39;</span><span class="si">{</span><span class="n">criterion</span><span class="si">}</span><span class="s2">&#39;. </span><span class="se">\</span>
<span class="s2">In your analysis, be sure to describe in a clear and concise way, any findings or any patterns you </span><span class="se">\</span>
<span class="s2">observe, and identify any outliers or anomalies in the data. </span><span class="se">\</span>
<span class="s2">Limit your description to one paragraph with no more than 250 words.</span>

<span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span><span class="si">}</span>

<span class="s2">&quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Imagine that you are a researcher analyzing a bibliographic dataset. </span><span class="se">\</span>
<span class="s2">The table below provides data on top most frequent </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">criterion</span><span class="si">}</span><span class="s2"> in the dataset. </span><span class="se">\</span>
<span class="s2">The terms &#39;</span><span class="si">{</span><span class="n">col0</span><span class="si">}</span><span class="s2">&#39; and &#39;</span><span class="si">{</span><span class="n">col1</span><span class="si">}</span><span class="s2">&#39; in the column &#39;Period&#39; represent the time windows. </span><span class="se">\</span>
<span class="s2">The column &#39;Num Documents&#39; represents the number of documents in the time window. </span><span class="se">\</span>
<span class="s2">Use the information in the table to draw conclusions about growth trends of the &#39;</span><span class="si">{</span><span class="n">criterion</span><span class="si">}</span><span class="s2">&#39;. </span><span class="se">\</span>
<span class="s2">In your analysis, be sure to describe in a clear and concise way, any findings or any patterns you </span><span class="se">\</span>
<span class="s2">observe, and identify any outliers or anomalies in the data. </span><span class="se">\</span>
<span class="s2">Limit your description to one paragraph with no more than 250 words.</span>

<span class="si">{</span><span class="n">table</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">()</span><span class="si">}</span>

<span class="s2">&quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">_filter_indicators_by_custom_topics</span><span class="p">(</span><span class="n">indicators</span><span class="p">,</span> <span class="n">topics_length</span><span class="p">,</span> <span class="n">custom_topics</span><span class="p">):</span>
    <span class="c1"># Copy the indicators dataframe to avoid mutating the original dataframe.</span>
    <span class="n">indicators_copy</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># If custom topics are provided, only keep indicators that are in the custom</span>
    <span class="c1"># topics list.</span>
    <span class="k">if</span> <span class="n">custom_topics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">custom_topics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">topic</span> <span class="k">for</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">custom_topics</span> <span class="k">if</span> <span class="n">topic</span> <span class="ow">in</span> <span class="n">indicators</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="p">]</span>
    <span class="c1"># If no custom topics are provided, keep the first n rows of the indicators</span>
    <span class="c1"># dataframe, where n is the number of topics.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">custom_topics</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">custom_topics</span> <span class="o">=</span> <span class="n">custom_topics</span><span class="p">[:</span><span class="n">topics_length</span><span class="p">]</span>

    <span class="c1"># Filter the indicators dataframe by the custom topics.</span>
    <span class="n">indicators_copy</span> <span class="o">=</span> <span class="n">indicators_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">custom_topics</span><span class="p">,</span> <span class="p">:]</span>

    <span class="k">return</span> <span class="n">indicators_copy</span>


<span class="k">def</span> <span class="nf">_make_plot</span><span class="p">(</span><span class="n">indicators</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">col0</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">indicators</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Num Documents&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">criterion</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">hover_data</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Num Documents&quot;</span><span class="p">],</span>
        <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span>
        <span class="n">color_discrete_map</span><span class="o">=</span><span class="p">{</span>
            <span class="n">col0</span><span class="p">:</span> <span class="s2">&quot;#8da4b4&quot;</span><span class="p">,</span>
            <span class="n">col1</span><span class="p">:</span> <span class="s2">&quot;#556f81&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">autorange</span><span class="o">=</span><span class="s2">&quot;reversed&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span>
        <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
        <span class="n">griddash</span><span class="o">=</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span>

    <span class="c1">###############################################################################</span>


<span class="c1">#     records = read_records(</span>
<span class="c1">#         directory=directory,</span>
<span class="c1">#         database=database,</span>
<span class="c1">#         start_year=start_year,</span>
<span class="c1">#         end_year=end_year,</span>
<span class="c1">#         **filters,</span>
<span class="c1">#     )</span>

<span class="c1">#     indicators = _growth_indicators_from_records(</span>
<span class="c1">#         column=criterion,</span>
<span class="c1">#         time_window=time_window,</span>
<span class="c1">#         directory=directory,</span>
<span class="c1">#         records=records,</span>
<span class="c1">#     )</span>

<span class="c1">#     indicators = _make_table(indicators)</span>
<span class="c1">#     results = _Results()</span>
<span class="c1">#     results.table_ = indicators.copy()</span>

<span class="c1">#     indicators = _filter_indicators(</span>
<span class="c1">#         indicators,</span>
<span class="c1">#         topics_length,</span>
<span class="c1">#         custom_topics,</span>
<span class="c1">#     )</span>

<span class="c1">#     results = _Results()</span>
<span class="c1">#     results.table_ = indicators.copy()</span>

<span class="c1">#     col0 = indicators.columns[0]</span>
<span class="c1">#     col1 = indicators.columns[1]</span>
<span class="c1">#     indicators = indicators.head(topics_length)</span>
<span class="c1">#     indicators = indicators.reset_index()</span>

<span class="c1">#     indicators = indicators.melt(id_vars=criterion, value_vars=[col0, col1])</span>
<span class="c1">#     indicators = indicators.rename(</span>
<span class="c1">#         columns={</span>
<span class="c1">#             criterion: criterion.replace(&quot;_&quot;, &quot; &quot;).title(),</span>
<span class="c1">#             &quot;variable&quot;: &quot;Period&quot;,</span>
<span class="c1">#             &quot;value&quot;: &quot;Num Documents&quot;,</span>
<span class="c1">#         }</span>
<span class="c1">#     )</span>

<span class="c1">#     results.plot_ = _make_plot(indicators, criterion, col0, col1)</span>
<span class="c1">#     return results</span>


<span class="c1"># def _filter_indicators(indicators, topics_length, custom_topics):</span>
<span class="c1">#     indicators = indicators.copy()</span>
<span class="c1">#     if custom_topics is not None:</span>
<span class="c1">#         custom_topics = [</span>
<span class="c1">#             topic for topic in custom_topics if topic in indicators.index.tolist()</span>
<span class="c1">#         ]</span>
<span class="c1">#     else:</span>
<span class="c1">#         custom_topics = indicators.index.copy()</span>
<span class="c1">#         custom_topics = custom_topics[:topics_length]</span>

<span class="c1">#     indicators = indicators.loc[custom_topics, :]</span>

<span class="c1">#     return indicators</span>


<span class="c1"># def _make_table(indicators):</span>

<span class="c1">#     indicators = indicators[indicators.columns[:2]]</span>
<span class="c1">#     indicators = indicators.assign(</span>
<span class="c1">#         num_documents=indicators[indicators.columns[0]]</span>
<span class="c1">#         + indicators[indicators.columns[1]]</span>
<span class="c1">#     )</span>
<span class="c1">#     indicators = indicators.sort_values(by=&quot;num_documents&quot;, ascending=False)</span>
<span class="c1">#     indicators.pop(&quot;num_documents&quot;)</span>
<span class="c1">#     return indicators</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>